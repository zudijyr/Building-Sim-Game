#!/usr/bin/env python

from sim.renderers.pyglet import PygletRenderer
from sim.models.tile_map import TileMap
from sim.models.tile_grid import TileGrid

from sim.models.terrain import Forest
from sim.models.terrain import Grass
from sim.models.terrain import Water

from sim.models.terrain_improvement import Road

from sim.models.unit.peasant import Peasant
from sim.models.unit.ship import Ship

from sim.models.building.fishing_hole import FishingHole
from sim.models.building.dock import Dock

def main():
	tile_grid = TileGrid(20, 20)
	tile_map = TileMap(tile_grid, 40)

	### add terrain
	[ t.set_terrain(Grass) for t in tile_grid.get_tiles_in_rect(0,  1, 20, 9) ]
	[ t.set_terrain(Water) for t in tile_grid.get_tiles_in_rect(0, 11, 20, 9) ]
	tile_grid.get_tile(7, 7).set_terrain(Forest)
	###

	### add improvements
	imp_tiles = tile_grid.get_tiles_in_rect(5, 3, 1, 8)
	print("count of imp tiles: {}".format(len(imp_tiles)))
	[ t.set_terrain_improvement(Road) for t in imp_tiles ]
	###

	### add buildings
	building1 = FishingHole()
	building2 = Dock()
	building3 = Dock()
	building4 = Dock()
	tile_map.place_building_on_grid(building1, 5, 15)
	tile_map.place_building_on_grid(building2, 6, 10)
	tile_map.place_building_on_grid(building3, 6, 11)
	tile_map.place_building_on_grid(building4, 6, 12)
	###

	### add units
	unit1 = Peasant()
	tile_map.place_unit_on_grid(unit1, 4, 4)
	unit1.add_path_on_grid(7, 7)
	unit1.add_action(unit1.check_for_wood_to_chop, quantity=10)
	unit1.add_path_on_grid(8, 7)
	unit1.add_action(unit1.attempt_to_build_cabbage_farm)
	unit1.add_path_on_grid(8, 2)

	unit2 = Ship()
	tile_map.place_unit_on_grid(unit2, 8, 12)
	unit2.add_path_on_grid(5, 15)
	unit2.add_path_on_grid(5, 12)
	###

	renderer = PygletRenderer(tile_map, .05)
	renderer.run()

if __name__  == '__main__':
	main()
